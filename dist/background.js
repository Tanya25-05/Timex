let t=null,n=null,i=!1,c=0,u;chrome.runtime.onMessage.addListener((e,o,a)=>(e.action==="toggleTracking"?(i=e.isTracking,i?(n=Date.now(),c=0,chrome.tabs.query({active:!0,currentWindow:!0},function(r){r[0]&&(t=r[0].id,T())})):(t&&f(),t=null,n=null,clearInterval(u)),a({status:"success"})):e.action==="getTrackingStatus"?a({isTracking:i,currentTime:c}):e.action==="getCurrentTime"&&a({currentTime:c}),!0));function T(){clearInterval(u),u=setInterval(()=>{i&&n&&(c=Date.now()-n)},10)}chrome.tabs.onActivated.addListener(e=>{i&&d(e.tabId)});chrome.tabs.onUpdated.addListener((e,o,a)=>{i&&e===t&&o.status==="complete"&&d(e)});function d(e){t&&f(),t=e,n=Date.now(),c=0,T()}function f(){if(!n)return;const o=Date.now()-n;chrome.tabs.get(t,function(a){const r=new URL(a.url).hostname,l=new Date().toISOString().split("T")[0];chrome.storage.local.get([l],function(g){let s=g[l]||{};s[r]=(s[r]||0)+o;let m={};m[l]=s,chrome.storage.local.set(m)})})}
